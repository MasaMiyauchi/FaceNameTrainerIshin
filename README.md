# アプリケーション概要
顔と名前を記憶する能力を向上させるためのトレーニングアプリケーションです。  
AI生成された顔画像と名前を使用して記憶力を鍛えます。

# アプリケーション種別
- Webアプリケーション

# ユースケース
1. Webアプリケーションにアクセス  
2. トレーニングコースを選択  
   - 記憶する人数と一人当たりの記憶時間を設定  
3. 記憶スタート  
   - 顔＋名前を画面上で順次表示  
4. テストコースを選択  
   - **Aコース**：提示された名前に一致する顔を、3つの候補から選択  
   - **Bコース**：提示された顔に対応する名前を入力  
5. テスト結果の確認・フィードバック  
6. 結果履歴の参照・統計閲覧

# アプリケーションフロー
1. **トップページ表示**  
   - ロゴ／タイトル  
   - 「はじめる」ボタン  

2. **ユーザーログイン／ゲストアクセス**  
   - SNS認証（Google, Facebook など）  
   - メール＋パスワード認証  
   - ゲストアクセス（匿名）  

3. **ダッシュボード**  
   - 直近トレーニング履歴（スコア／正答率）  
   - 合計練習回数、ベストスコア  
   - 「新しいトレーニング」ボタン  

4. **トレーニング設定画面**  
   - コース選択（標準／チャレンジ）  
   - 記憶する人数（3～5人）  
   - 記憶表示時間（3秒、5秒、10秒）  
   - 「開始」ボタン  

5. **記憶モード**  
   - 顔＋名前を順次表示  
   - カウントダウンタイマー  
   - 「次へ」／「一時停止」／「キャンセル」ボタン  

6. **インターミッション**  
   - 「テストモードへ進む」  
   - 「記憶を復習」  

7. **テスト設定画面**  
   - Aコース／Bコース選択  
   - 問題数設定（記憶した人数分）  
   - 「テスト開始」ボタン  

8. **テストモード**  
   - **Aコース**：名前表示 → 3つの顔から選択  
   - **Bコース**：顔表示 → テキスト入力フォーム  
   - 回答後すぐ次の問題へ  
   - 残り問題数・経過時間表示  

9. **結果表示画面**  
   - 正答数／正答率  
   - 問題ごとの正誤フィードバック  
   - 「再挑戦」／「ダッシュボードへ戻る」  

10. **履歴・統計画面**  
    - 日別／コース別スコア推移グラフ  
    - ベストスコア一覧  
    - （オプション）他ユーザーとのランキング比較  

11. **設定・プロフィール画面**  
    - ニックネーム／アイコン設定  
    - 通知設定（トレーニングリマインダー）  
    - テーマ切替（ライト／ダーク）  

12. **サポート・ヘルプ**  
    - チュートリアル動画  
    - FAQ  
    - お問い合わせフォーム 

##アプリケーションフロー開発フェーズ
下記フローは、次期開発項目とする。
2. **ユーザーログイン／ゲストアクセス**  
3. **ダッシュボード**  
   - 直近トレーニング履歴（スコア／正答率）  
   - 合計練習回数、ベストスコア  
10. **履歴・統計画面**  
    - 日別／コース別スコア推移グラフ  
    - ベストスコア一覧  
    - （オプション）他ユーザーとのランキング比較  
11. **設定・プロフィール画面**  
    - ニックネーム／アイコン設定  
    - 通知設定（トレーニングリマインダー）  
    - テーマ切替（ライト／ダーク）  

12. **サポート・ヘルプ**  
    - チュートリアル動画  
    - FAQ  
    - お問い合わせフォーム 

## 人物画像生成API

### 1. APIプロバイダ
- **Stability AI** の Stable Diffusion Text-to-Image API

### 2. 認証
- APIキーは環境変数 `STABILITY_API_KEY` に設定  
- 本番リポジトリには `.env` を直接保存せず、以下を運用  
  - `.env`：実際のキーを保持  
  - `.env.example`：変数名のみ記載  
  - `.gitignore`：`.env` を追加

### 3. エンドポイント
POST https://api.stability.ai/v2beta/stable-image/generate/core


### 4. リクエストパラメータ

| パラメータ   | 型       | 説明                                                              |
|--------------|----------|-------------------------------------------------------------------|
| `width`      | integer  | 出力画像の横幅（px）。本アプリでは `512` を固定                   |
| `height`     | integer  | 出力画像の高さ（px）。本アプリでは `512` を固定                   |
| `seed`       | integer  | 乱数シード（任意）。同一シードで再現性ある画像が取得可能          |
| `cfg_scale`  | float    | プロンプト準拠度（例：7.5）                                       |
| `samples`    | integer  | 生成枚数（本アプリでは `1` を指定）                               |

#### 4-1. 生成プロンプトテンプレート

(parameterX)-year-old (parameterY) japanese wearing a suit, photorealistic
  - `parameterX`：年齢（20, 30, 40, 50, 60, 70 のいずれかをランダム選択）  
  - `parameterY`：性別（`male` / `female` をランダム選択） 
  
### 5. レスポンス例
```json
{
  "artifacts": [
    {
      "base64": "...",    // 生成画像のBase64文字列
      "seed": 1234567890,
      "finishReason": "SUCCESS"
    }
  ]
}

### 6. 生成画像の保存・再利用

1. **保存処理**  
   - 生成後、バックエンドで受け取った Base64 文字列を JPEG/PNG に変換  
   - オブジェクトストレージ（例：AWS S3）またはローカルストレージにアップロード  

2. **メタデータ保持**  
   データベースに以下の構造で保存することを想定します。  
   
   | カラム名       | 型         | 説明                   |
   |----------------|------------|------------------------|
   | `id`           | UUID       | 主キー                 |
   | `image_url`    | VARCHAR    | 画像の保存先 URL       |
   | `age`          | INTEGER    | 生成時の年齢パラメータ |
   | `gender`       | VARCHAR    | 生成時の性別パラメータ |
   | `ethnicity`    | VARCHAR    | 生成時の人種パラメータ |
   | `seed`         | BIGINT     | 使用したシード値       |
   | `created_at`   | TIMESTAMP  | 生成日時               |

3. **キャッシュ機構**  
   - 同一プロンプト＆同一シードの場合は新規生成を避け、既存のレコードを返却  

---

### 7. エラーハンドリング

- **HTTP ステータスコード**  
  - `200`：正常応答  
  - `400`〜`499`：クライアントエラー（パラメータ不足／認証失敗など）  
  - `500`〜`599`：サーバーエラー  

- **リトライポリシー**  
  1. タイムアウト発生時：  
     - 2 秒間隔で最大 3 回リトライ  
  2. 5xx 系エラー時：  
     - 指数バックオフ（例：1s → 2s → 4s）で最大 3 回リトライ  

- **ログ出力**  
  - リクエスト・レスポンス全体（ヘッダー・ボディ）をログに記録  
  - エラー時はスタックトレースも合わせて保存  

---

### 8. 性能要件

- **生成時間**：  
  - API 呼び出し開始から画像取得完了まで **3 秒以内**  

- **同時リクエスト数**：  
  - バックエンド側で **最大 5 同時** を想定  

- **スループット**：  
  - 1 分間あたり **100 リクエスト** を目安  

---


#技術スタック
- フロントエンド: HTML, CSS, JavaScript
- バックエンド: 不要（クライアントサイドのみで動作）
- 外部API: （AI生成顔画像）
- データ保存:Stable Diffusion Text-to-Image API
- 画像データ：localStorage
- indentデータ：SQLite
-- 画像データファイル名、URI、画像パラメータ等を保存
